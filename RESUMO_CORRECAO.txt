â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    CORREÃ‡ÃƒO SOCKET.IO - RESUMO FINAL                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸš¨ PROBLEMA:
   Quando tentava abrir chat ou enviar mensagem, vinha o erro:
   âŒ GET http://localhost:4000/socket.io/?EIO=4&transport=polling 
      net::ERR_CONNECTION_REFUSED

   CAUSA: Frontend hardcoded para conectar a localhost:4000 em qualquer 
   ambiente (local, Vercel, Railway).

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… SOLUÃ‡ÃƒO APLICADA:

1ï¸âƒ£  CÃ“DIGO FRONTEND (TypeScript/Next.js)
   ğŸ“ Arquivos alterados:
   â€¢ socialjuris/app/dashboard/chat/[casoId]/page.tsx
   â€¢ socialjuris/app/dashboard/cliente/page.tsx
   
   ğŸ”„ Antes (ERRADO):
   const SOCKET_URL = "http://localhost:4000";
   
   ğŸ”„ Depois (CORRETO):
   const SOCKET_URL = process.env.NEXT_PUBLIC_SOCKET_URL || 
                      `${window.location.protocol}//${window.location.hostname}:...`
   
   âœ¨ BenefÃ­cio: Frontend agora se adapta automaticamente ao ambiente

2ï¸âƒ£  ARQUIVOS DE CONFIGURAÃ‡ÃƒO CRIADOS
   â€¢ socialjuris-backend/.env.example      (guia para backend)
   â€¢ CORRECAO_SOCKET_IO.md                 (instruÃ§Ãµes rÃ¡pidas)
   â€¢ SETUP_SOCKET_IO.md                    (documentaÃ§Ã£o completa)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“‹ PRÃ“XIMOS PASSOS - ADIOCIONE VARIÃVEIS DE AMBIENTE:

ğŸ”µ NO VERCEL (Dashboard da Vercel)
   1. VÃ¡ para: Settings > Environment Variables
   2. Adicione:
      
      NEXT_PUBLIC_API_URL
      â””â”€ Valor: https://seu-backend-railway.railway.app/api
      
      NEXT_PUBLIC_SOCKET_URL
      â””â”€ Valor: https://seu-backend-railway.railway.app

ğŸŸ  NO RAILWAY (Dashboard do Railway - Backend)
   1. VÃ¡ para sua aplicaÃ§Ã£o
   2. Adicione/Verifique:
      
      CORS_ORIGIN
      â””â”€ Valor: https://seu-frontend.vercel.app
      
      PORT
      â””â”€ Valor: 4000
      
      DATABASE_URL
      â””â”€ (JÃ¡ deve existir)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ§ª TESTE LOCALMENTE:

   Terminal 1 (Backend):
   $ cd socialjuris-backend
   $ npm install
   $ npm start
   
   Espere ver: "ğŸ”¥ Backend + Socket.io rodando na porta 4000"

   Terminal 2 (Frontend):
   $ cd socialjuris
   $ npm install
   $ npm run dev
   
   Espere ver: "â–² Next.js 15.x started"

   Acesse: http://localhost:3000/dashboard/cliente
   
   âœ… DevTools (F12) > Console nÃ£o deve ter erros
   âœ… Tente enviar mensagem no chat
   âœ… Tente iniciar videochamada

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š MAPEAMENTO DE URLS:

   DESENVOLVIMENTO LOCAL:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Frontend           â”‚  Backend Socket.IO
   â”‚  http://localhost:3000  â†â†’  http://localhost:4000
   â”‚  API: /api          â”‚  API Route: /api
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   PRODUÃ‡ÃƒO (Vercel + Railway):
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Frontend                        â”‚  Backend
   â”‚  https://seu-app.vercel.app  â†â†’  https://seu-backend.railway.app
   â”‚  Socket.IO: verifica CORS        â”‚  Express + Socket.IO
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ› SE AINDA TIVER ERRO:

1. Abra DevTools (F12) > Console
   â””â”€ Procure por mensagens de erro

2. Verifique Network > socket.io
   â””â”€ Qual URL estÃ¡ sendo requisitada?
   â””â”€ Qual status HTTP? (200, 404, 502, etc?)

3. No backend (terminal), procure por:
   â””â”€ "âš¡ Cliente conectado" = Socket.IO OK
   â””â”€ Logs de erro = problema com CORS ou conexÃ£o

4. Teste direto a URL do backend:
   curl https://seu-backend.railway.app/socket.io/?EIO=4&transport=polling
   â””â”€ Deve responder com dados, nÃ£o com erro 502/503

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“š DOCUMENTAÃ‡ÃƒO:
   â€¢ CORRECAO_SOCKET_IO.md   â† InstruÃ§Ãµes rÃ¡pidas (LEIA ISSO PRIMEIRO)
   â€¢ SETUP_SOCKET_IO.md      â† DocumentaÃ§Ã£o completa e troubleshooting

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ¨ RESUMO:
   âœ… CÃ³digo do frontend corrigido
   âœ… Suporte a variÃ¡veis de ambiente adicionado
   âœ… Funciona em localhost, Vercel e Railway
   âœ… DocumentaÃ§Ã£o criada
   âœ… Commit realizado

PRÃ“XIMO: Fazer o push e aguardar deploy automÃ¡tico no Vercel/Railway

git push origin main

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Data: 26/11/2025
Status: âœ… IMPLEMENTADO
